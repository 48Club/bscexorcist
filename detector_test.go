package bscexorcist

import (
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/ethereum/go-ethereum/core/types"
	"testing"
)

func TestDetectSandwichForBundle(t *testing.T) {
	tests := []struct {
		name    string
		logs    [][]*types.Log
		wantErr bool
	}{
		{
			name:    "testCase1",
			logs:    testCase1,
			wantErr: true,
		},
		{
			name:    "testCase2",
			logs:    testCase2,
			wantErr: true,
		},
		{
			name:    "testCase3",
			logs:    testCase3,
			wantErr: true,
		},
		{
			name:    "testCase4",
			logs:    testCase4,
			wantErr: true,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if err := DetectSandwichForBundle(tt.logs); (err != nil) != tt.wantErr {
				t.Errorf("DetectSandwichForBundle() error = %v, wantErr %v", err, tt.wantErr)
			}
		})
	}
}

var (
	testCase1 = [][]*types.Log{
		// tx1
		{
			{
				Address: common.HexToAddress("0xE21d99B42ECCbb7eA0e185f561B0a80fE1FC4d1C"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
				},
				Data: hexutil.MustDecode("0x00000000000000000000000000000000000000000000001a2241a49c6b6245af000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010d978570f31444e0ce7"),
			},
		},
		// tx2
		{
			{
				Address: common.HexToAddress("0xE21d99B42ECCbb7eA0e185f561B0a80fE1FC4d1C"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
				},
				Data: hexutil.MustDecode("0x00000000000000000000000000000000000000000000000acf3b1b8894e40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006dedd5cc45eb0799505"),
			},
		},
		// tx3
		{
			{
				Address: common.HexToAddress("0xE21d99B42ECCbb7eA0e185f561B0a80fE1FC4d1C"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
				},
				Data: hexutil.MustDecode("0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000058f71f3c5037542b775000000000000000000000000000000000000000000000008b621b4b388f9b2590000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
		// tx4
		{
			{
				Address: common.HexToAddress("0xE21d99B42ECCbb7eA0e185f561B0a80fE1FC4d1C"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
				},
				Data: hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b4a06634a2dcf0b5572000000000000000000000000000000000000000000000011823e3b2b071b29270000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
	}

	testCase2 = [][]*types.Log{
		// tx1
		{
			{
				Address: common.HexToAddress("0x8BC4BE4d483d1B3EA5Bf7D5a392A3b4bD9A874A9"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
				},
				Data: hexutil.MustDecode("0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b8807aba155303280000000000000000000000000000000000000000002b58249b01a661c0bcd08c0000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
		// tx2
		{
			{
				Address: common.HexToAddress("0x8BC4BE4d483d1B3EA5Bf7D5a392A3b4bD9A874A9"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
				},
				Data: hexutil.MustDecode("0x00000000000000000000000000000000000000000002fca1f25b3dba8d6764410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011f852d27d9ffa52"),
			},
		},
		// tx3
		{
			{
				Address: common.HexToAddress("0x8BC4BE4d483d1B3EA5Bf7D5a392A3b4bD9A874A9"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
				},
				Data: hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006de97e09bd1800000000000000000000000000000000000000000000000fb17f35d5ccd60f325f5e0000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
		// tx4
		{
			{
				Address: common.HexToAddress("0x8BC4BE4d483d1B3EA5Bf7D5a392A3b4bD9A874A9"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
				},
				Data: hexutil.MustDecode("0x0000000000000000000000000000000000000000001156750acd75c0b37eb9d10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000076d82e76d8bdbca2"),
			},
		},
		// tx5
		{
			{
				Address: common.HexToAddress("0x8BC4BE4d483d1B3EA5Bf7D5a392A3b4bD9A874A9"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
				},
				Data: hexutil.MustDecode("0x0000000000000000000000000000000000000000001a01af903430a10d3e16ba0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000073f8036b326e0c03"),
			},
		},
	}

	testCase3 = [][]*types.Log{
		// tx1
		{
			{
				Address: common.HexToAddress("0x9Ae10A97634Ff4Cff2397D35DDD7f62C2446667D"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
				},
				Data: hexutil.MustDecode("0xfffffffffffffffffffffffffffffffffffffffffffff32c5190561236a289a00000000000000000000000000000000000000000000000000d133dbb20f49e85000000000000000000000000000000000000000001031a64b244a9110948bbe0000000000000000000000000000000000000000000000a10991d832477b35a73fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe4fb3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c4709ca0c20"),
			},
		},
		// tx2
		{
			{
				Address: common.HexToAddress("0x9Ae10A97634Ff4Cff2397D35DDD7f62C2446667D"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
				},
				Data: hexutil.MustDecode("0xfffffffffffffffffffffffffffffffffffffffffffffec80c99f25d775f4984000000000000000000000000000000000000000000000000013fbe85edc90000000000000000000000000000000000000000000001033a289b1564a5e06e79f1000000000000000000000000000000000000000000000a10991d832477b35a73fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe4fbd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b381cb8400"),
			},
		},
		// tx3
		{
			{
				Address: common.HexToAddress("0x9Ae10A97634Ff4Cff2397D35DDD7f62C2446667D"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
				},
				Data: hexutil.MustDecode("0x0000000000000000000000000000000000000000000007b2357632c1df3813d2fffffffffffffffffffffffffffffffffffffffffffffffff82218dadfb22c48000000000000000000000000000000000000000001027210cec6e24142da238c000000000000000000000000000000000000000000000a10991d832477b35a73fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe4f8100000000000000000000000000000000000000000000000010a4f26ee3c5117f0000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
		// tx4
		{
			{
				Address: common.HexToAddress("0x9Ae10A97634Ff4Cff2397D35DDD7f62C2446667D"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
				},
				Data: hexutil.MustDecode("0x00000000000000000000000000000000000000000000052178f9772bea25628bfffffffffffffffffffffffffffffffffffffffffffffffffac821a82c62031a00000000000000000000000000000000000000000101ed56dfbb168c2a220ce7000000000000000000000000000000000000000000000a10991d832477b35a73fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe4f580000000000000000000000000000000000000000000000000b18a19f428360ff0000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
	}

	testCase4 = [][]*types.Log{
		// tx1
		{
			{
				Address: common.HexToAddress("0xb6Bb744FB59fa399D09f67Ae3634942F533B577f"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x00000000000000000000000000000000c5d17f1bb0245b5eb1cf27c28115996e"),
					common.HexToHash("0x00000000000000000000000000000000c5d17f1bb0245b5eb1cf27c28115996e"),
				},
				Data: hexutil.MustDecode("0xffffffffffffffffffffffffffffffffffffffffffffffff260af37100191b240000000000000000000000000000000000000000000000024b272c4a030060000000000000000000000000000000000000000001a4f8d670605487c25e5848ae0000000000000000000000000000000000000000000001127b950b545353219f00000000000000000000000000000000000000000000000000000000000026dc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000180cbee2ac519"),
			},
		},
		// tx2
		{
			{
				Address: common.HexToAddress("0xb6Bb744FB59fa399D09f67Ae3634942F533B577f"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x0000000000000000000000000f4a1d7fdf4890be35e71f3e0bbc4a0ec377eca3"),
					common.HexToHash("0x0000000000000000000000000f4a1d7fdf4890be35e71f3e0bbc4a0ec377eca3"),
				},
				Data: hexutil.MustDecode("0xffffffffffffffffffffffffffffffffffffffffffffffffe34853336dfc15ef0000000000000000000000000000000000000000000000004db73254763000000000000000000000000000000000000000000001a541501ac1e373df9a4cab350000000000000000000000000000000000000000000001127b950b545353219f00000000000000000000000000000000000000000000000000000000000026e90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000032ee841b8000"),
			},
		},
		// tx3
		{
			{
				Address: common.HexToAddress("0xb6Bb744FB59fa399D09f67Ae3634942F533B577f"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x00000000000000000000000000000000c5d17f1bb0245b5eb1cf27c28115996e"),
					common.HexToHash("0x00000000000000000000000000000000c5d17f1bb0245b5eb1cf27c28115996e"),
				},
				Data: hexutil.MustDecode("0x000000000000000000000000000000000000000000000000d9f50c8effe6e4dcfffffffffffffffffffffffffffffffffffffffffffffffdb4734e6942e114920000000000000000000000000000000000000001a3c40f235663b5146d9e256c00000000000000000000000000000000000000000000033610b8541f16501c5e00000000000000000000000000000000000000000000000000000000000026a200000000000000000000000000000000000000000000000000008ed7277121990000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
	}
)
