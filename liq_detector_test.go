package bscexorcist

import (
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/ethereum/go-ethereum/core/types"
	"testing"
)

func TestMyDetectLiqSandwichForBundle(t *testing.T) {
	tests := []struct {
		name    string
		logs    [][]*types.Log
		wantErr bool
	}{
		{
			name:    "liqTestCase1",
			logs:    liqTestCase1,
			wantErr: true,
		},
		{
			name:    "liqTestCase2",
			logs:    liqTestCase2,
			wantErr: true,
		},
		{
			name:    "liqTestCase2",
			logs:    liqTestCase3,
			wantErr: true,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if err := DetectSandwichForBundle(tt.logs); (err != nil) != tt.wantErr {
				t.Errorf("DetectSandwichForBundle() error = %v, wantErr %v", err, tt.wantErr)
			}
		})
	}
}

var (
	liqTestCase1 = [][]*types.Log{
		// tx1
		{
			{
				Address: common.HexToAddress("0xcF59B8C8BAA2dea520e3D549F97d4e49aDE17057"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x00000000000000000000000062b652a210eeaa6023dba46878ad9c0d8240e7b4"),
					common.HexToHash("0x000000000000000000000000b79f216a32fc4ad489f438122a9580bbcd2a09e5"),
				},
				Data: hexutil.MustDecode("0x0000000000000000000000000000000000000000000002c3a1ae8e01249ca907ffffffffffffffffffffffffffffffffffffffffffffffe7f7ce72613b55c1d000000000000000000000000000000000000000002f0d6ac3ec17dd264f2bcf910000000000000000000000000000000000000000000047f05d741be500899affffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7ba700000000000000000000000000000000000000000000000005fa62e4d6c568a70000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
		// tx2
		{
			{
				Address: common.HexToAddress("0xcF59B8C8BAA2dea520e3D549F97d4e49aDE17057"),
				Topics: []common.Hash{
					common.HexToHash("0x7a53080ba414158be7ec69b987b5fb7d07dee101fe85488f0853ae16239d0bde"),
					common.HexToHash("0x00000000000000000000000046a15b0b27311cedf172ab29e4f4766fbe7f4364"),
					common.HexToHash("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7ba8"),
					common.HexToHash("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7c2f"),
				},
				Data: hexutil.MustDecode("0x00000000000000000000000046a15b0b27311cedf172ab29e4f4766fbe7f436400000000000000000000000000000000000000000000208af90cc3a96e755d26000000000000000000000000000000000000000000000130e8d71eea8e88402c0000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
		// tx3
		{
			{
				Address: common.HexToAddress("0xcF59B8C8BAA2dea520e3D549F97d4e49aDE17057"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x00000000000000000000000062b652a210eeaa6023dba46878ad9c0d8240e7b4"),
					common.HexToHash("0x0000000000000000000000000c8d414f4e9cb1c8b27e392657b619702f5ac974"),
				},
				Data: hexutil.MustDecode("0xfffffffffffffffffffffffffffffffffffffffffffffee405675bb1893815c00000000000000000000000000000000000000000000000099ce09f0c4eaa7f4600000000000000000000000000000000000000002f2396212cf1c905ad602b5500000000000000000000000000000000000000000000976ad03235749b3f2a01ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7bcc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014ca1c2e3dc6e1"),
			},
		},
	}

	liqTestCase2 = [][]*types.Log{
		// tx1
		{
			{
				Address: common.HexToAddress("0x4392a074293a798a22b26BaD37E284DfA45bf327"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0x000000000000000000000000b79f216a32fc4ad489f438122a9580bbcd2a09e5"),
					common.HexToHash("0x000000000000000000000000b79f216a32fc4ad489f438122a9580bbcd2a09e5"),
				},
				Data: hexutil.MustDecode("0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000363af421ae34dddad60000000000000000000000000000000000000000000001abd1321d2ef83ff9b70000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
		// tx2
		{
			{
				Address: common.HexToAddress("0x4392a074293a798a22b26BaD37E284DfA45bf327"),
				Topics: []common.Hash{
					common.HexToHash("0x4c209b5fc8ad50758f13e2e1088ba56a560dff690a1c6fef26394f4c03821c4f"),
					common.HexToHash("0x00000000000000000000000010ed43c718714eb63d5aa57b78b54704e256024e"),
				},
				Data: hexutil.MustDecode("0x00000000000000000000000000000000000000000000000208edf11b23c0d80d000000000000000000000000000000000000000000000002b5e3af16b1880000"),
			},
		},
		// tx3
		{
			{
				Address: common.HexToAddress("0x4392a074293a798a22b26BaD37E284DfA45bf327"),
				Topics: []common.Hash{
					common.HexToHash("0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822"),
					common.HexToHash("0x0000000000000000000000000c8d414f4e9cb1c8b27e392657b619702f5ac974"),
					common.HexToHash("0x0000000000000000000000000c8d414f4e9cb1c8b27e392657b619702f5ac974"),
				},
				Data: hexutil.MustDecode("0x0000000000000000000000000000000000000000000000ab207a7212c9b330af000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000311a7a7be41a2db71a"),
			},
		},
	}

	liqTestCase3 = [][]*types.Log{
		// tx1
		{
			{
				Address: common.HexToAddress("0xD7af60112d7dfE0f914724E3407Dd54424AAA19b"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x00000000000000000000000000000007b0710829289a9146f640a1e0d8ed6dee"),
					common.HexToHash("0x00000000000000000000000000000007b0710829289a9146f640a1e0d8ed6dee"),
				},
				Data: hexutil.MustDecode("0x0000000000000000000000000000000000000000000003c9de6841a77ddb1cd2ffffffffffffffffffffffffffffffffffffffffffff080e5f840b5e4bd1080e00000000000000000000000000000000000000081673614aa09b92e71992876b0000000000000000000000000000000000000000004621703de9e0ea36d37f98000000000000000000000000000000000000000000000000000000000000a350000000000000000000000000000000000000000000000000083186089532daaa0000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
		// tx2
		{
			{
				Address: common.HexToAddress("0xD7af60112d7dfE0f914724E3407Dd54424AAA19b"),
				Topics: []common.Hash{
					common.HexToHash("0x0c396cd989a39f4459b5fa1aed6a9a8dcdbc45908acfd67e028cd568da98982c"),
					common.HexToHash("0x00000000000000000000000046a15b0b27311cedf172ab29e4f4766fbe7f4364"),
					common.HexToHash("0x000000000000000000000000000000000000000000000000000000000000a361"),
					common.HexToHash("0x000000000000000000000000000000000000000000000000000000000000a363"),
				},
				Data: hexutil.MustDecode("0x000000000000000000000000000000000000000002b03f8f3c59983655289ba000000000000000000000000000000000000000000000022d32699d243322476b0000000000000000000000000000000000000000000000000000000000000000"),
			},
		},
		// tx3
		{
			{
				Address: common.HexToAddress("0xD7af60112d7dfE0f914724E3407Dd54424AAA19b"),
				Topics: []common.Hash{
					common.HexToHash("0x19b47279256b2a23a1665c810c8d55a1758940ee09377d4f8d26497a3577dc83"),
					common.HexToHash("0x00000000000000000000000000000007b0710829289a9146f640a1e0d8ed6dee"),
					common.HexToHash("0x00000000000000000000000000000007b0710829289a9146f640a1e0d8ed6dee"),
				},
				Data: hexutil.MustDecode("0xfffffffffffffffffffffffffffffffffffffffffffffc35ecac63161812e8ab00000000000000000000000000000000000000000000f7f1a07bf4a1b42ef7f2000000000000000000000000000000000000000817043161851d8ba4dd4dab82000000000000000000000000000000000000000000d56c83c6eb5b2343975470000000000000000000000000000000000000000000000000000000000000a35600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000021839a6b4af5d3932"),
			},
		},
	}
)
